<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- 1. é’ˆå¯¹å¾®ä¿¡çš„è§†å£è®¾ç½® (ç¦æ­¢ç¼©æ”¾ï¼Œè‡ªåŠ¨å¡«å……) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <title>Christmas 2026</title>
    <style>
      /* 2. æš´åŠ›é‡ç½®ï¼šå¼ºåˆ¶å æ»¡å±å¹• */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        width: 100%; height: 100%; 
        overflow: hidden; background-color: #000;
        /* ä½¿ç”¨ absolute ä»£æ›¿ fixedï¼Œå…¼å®¹å¾®ä¿¡ */
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      }
      /* 3. å¼ºåˆ¶ Canvas æ’‘æ»¡çˆ¶å®¹å™¨ */
      #root { width: 100%; height: 100%; }
      canvas { 
        display: block; 
        width: 100vw !important; 
        height: 100vh !important; /* å¼ºåˆ¶è§†å£é«˜åº¦ */
        object-fit: cover;
      }
    </style>
    <script type="module" crossorigin src="./assets/index-CVRyuv3a.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/react-vendor-Bzgz95E1.js">
    <link rel="modulepreload" crossorigin href="./assets/three-vendor-IWongE37.js">
    <link rel="modulepreload" crossorigin href="./assets/postprocessing-vendor-Oz0s9CZI.js">
  </head>
  <body>
    <div id="root"></div>

    <!-- ==================== UI å±‚ ==================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- åº•éƒ¨æ–‡å­—ï¼šå¹³æ—¶æ˜¾ç¤º (åŠé€æ˜ï¼Œä¸æŒ¡ç”»é¢) -->
    <div style="
      position: fixed; bottom: 20px; width: 100%; text-align: center;
      color: rgba(255,255,255,0.4); font-size: 12px; z-index: 998; pointer-events: none;
      text-shadow: 0 1px 2px #000;
    ">
      å…¬ä¼—å· Â· è·å˜‰è¯—è¯ç©ºé—´
    </div>

    <!-- ä¸¤ä¸ªæ–‡å­—æŒ‰é’® (æ— èƒŒæ™¯) -->
    <div style="position: fixed; bottom: 60px; width: 100%; display: flex; justify-content: center; gap: 50px; z-index: 999;">
      <div onclick="document.querySelector('input[type=file]').click()" style="color: #fff; font-size: 15px; cursor: pointer; text-shadow: 0 2px 4px #000;">
        ğŸ æŒ‚ç…§ç‰‡
      </div>
      <div onclick="createPoster()" style="color: #fceabb; font-size: 15px; cursor: pointer; font-weight: bold; text-shadow: 0 2px 4px #000;">
        âœ¨ ç”Ÿæˆè´ºå¡
      </div>
    </div>

    <!-- æµ·æŠ¥å¼¹çª— -->
    <div id="poster-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; align-items: center; justify-content: center;">
      <img id="final-image" style="width: 85%; max-width: 450px; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);" />
      <div onclick="document.getElementById('poster-modal').style.display='none'" style="margin-top: 30px; color: #fff; font-size: 30px;">Ã—</div>
    </div>

    <div id="qrcode-container" style="display: none;"></div>

    <script>
      function createPoster() {
        const treeCanvas = document.querySelector('canvas');
        if (!treeCanvas) { alert('åŠ è½½ä¸­...'); return; }

        const cvs = document.createElement('canvas');
        const ctx = cvs.getContext('2d');
        const W = 1080; const H = 1920; 
        cvs.width = W; cvs.height = H;

        // 1. ç»˜åˆ¶èƒŒæ™¯ï¼šå…¨é»‘
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, W, H);
        
        // 2. ç»˜åˆ¶æ ‘ï¼šã€å¼ºåˆ¶æ”¾å¤§é“ºæ»¡å…¨å±ã€‘
        const sW = treeCanvas.width;
        const sH = treeCanvas.height;
        // ä½¿ç”¨ cover ç®—æ³•ï¼Œå–æœ€å¤§æ¯”ä¾‹ï¼Œä¿è¯ä¸ç•™é»‘è¾¹
        const scale = Math.max(W/sW, H/sH); 
        const dx = (W - sW * scale) / 2;
        const dy = (H - sH * scale) / 2;
        ctx.drawImage(treeCanvas, dx, dy, sW * scale, sH * scale);

        // 3. åº•éƒ¨ç”»ä¸€ä¸ªæ¸å˜é®ç½© (ä¸ºäº†è®©æµ®åœ¨ä¸Šé¢çš„æ–‡å­—èƒ½çœ‹æ¸…)
        const gradient = ctx.createLinearGradient(0, H - 500, 0, H);
        gradient.addColorStop(0, 'rgba(0,0,0,0)'); // ä¸Šé¢é€æ˜
        gradient.addColorStop(1, 'rgba(0,0,0,0.8)'); // ä¸‹é¢åŠé€æ˜é»‘
        ctx.fillStyle = gradient;
        ctx.fillRect(0, H - 500, W, 500); // é®ç½©åªå åº•éƒ¨ä¸€éƒ¨åˆ†ï¼Œä¸å ç©ºé—´

        // 4. æ–‡å­— (ç›´æ¥å†™åœ¨é®ç½©ä¸Š)
        ctx.textAlign = 'center';
        
        // 2026 æ°´å°
        ctx.font = 'bold 180px "Times New Roman"';
        ctx.fillStyle = 'rgba(255,255,255,0.05)';
        ctx.fillText('2026', W/2, H - 400);

        // ç¥ç¦è¯­
        ctx.font = '50px "Songti SC", serif';
        ctx.fillStyle = '#fceabb';
        ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 10;
        ctx.fillText("å²å²å¸¸æ¬¢æ„‰ï¼Œå¹´å¹´çš†èƒœæ„", W/2, H - 350);
        ctx.shadowBlur = 0;

        // 5. äºŒç»´ç  (æµ®åœ¨åº•éƒ¨ï¼Œä¸å•ç‹¬å ä½)
        document.getElementById('qrcode-container').innerHTML = '';
        new QRCode(document.getElementById('qrcode-container'), {
          text: window.location.href, width: 256, height: 256,
          colorDark : "#d4af37", colorLight : "transparent",
          correctLevel : QRCode.CorrectLevel.H
        });

        setTimeout(() => {
          const qrImg = document.getElementById('qrcode-container').querySelector('img');
          if (qrImg) {
            const qrCenterY = H - 200; // æ”¾åœ¨æœ€åº•éƒ¨
            
            // è£…é¥°çƒåº•åº§
            ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 20;
            ctx.fillStyle = '#b32020'; 
            ctx.beginPath(); ctx.arc(W/2, qrCenterY, 90, 0, Math.PI * 2); ctx.fill();
            
            // æŒ‚ç»³
            ctx.strokeStyle = '#d4af37'; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(W/2, qrCenterY - 90); ctx.lineTo(W/2, qrCenterY - 250); ctx.stroke();
            
            // äºŒç»´ç ç™½åº•
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(W/2, qrCenterY, 75, 0, Math.PI * 2); ctx.fill(); ctx.shadowBlur = 0;
            
            // äºŒç»´ç 
            ctx.drawImage(qrImg, (W - 120)/2, qrCenterY - 60, 120, 120);
            
            // å…¬ä¼—å·æ–‡å­— (æµ®åœ¨äºŒç»´ç ä¸‹é¢)
            ctx.font = '28px "Microsoft YaHei"'; ctx.fillStyle = '#fff';
            ctx.fillText('å…¬ä¼—å· Â· è·å˜‰è¯—è¯ç©ºé—´', W/2, H - 60);
          }
          document.getElementById('final-image').src = cvs.toDataURL('image/jpeg', 0.9);
          document.getElementById('poster-modal').style.display = 'flex';
        }, 100);
      }
    </script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- 1. é’ˆå¯¹å¾®ä¿¡çš„è§†å£è®¾ç½® (ç¦æ­¢ç¼©æ”¾ï¼Œè‡ªåŠ¨å¡«å……) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <title>Christmas 2026</title>
    <style>
      /* 2. æš´åŠ›é‡ç½®ï¼šå¼ºåˆ¶å æ»¡å±å¹• */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        width: 100%; height: 100%; 
        overflow: hidden; background-color: #000;
        /* ä½¿ç”¨ absolute ä»£æ›¿ fixedï¼Œå…¼å®¹å¾®ä¿¡ */
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      }
      /* 3. å¼ºåˆ¶ Canvas æ’‘æ»¡çˆ¶å®¹å™¨ */
      #root { width: 100%; height: 100%; }
      canvas { 
        display: block; 
        width: 100vw !important; 
        height: 100vh !important; /* å¼ºåˆ¶è§†å£é«˜åº¦ */
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- ==================== UI å±‚ ==================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- åº•éƒ¨æ–‡å­—ï¼šå¹³æ—¶æ˜¾ç¤º (åŠé€æ˜ï¼Œä¸æŒ¡ç”»é¢) -->
    <div style="
      position: fixed; bottom: 20px; width: 100%; text-align: center;
      color: rgba(255,255,255,0.4); font-size: 12px; z-index: 998; pointer-events: none;
      text-shadow: 0 1px 2px #000;
    ">
      å…¬ä¼—å· Â· è·å˜‰è¯—è¯ç©ºé—´
    </div>

    <!-- ä¸¤ä¸ªæ–‡å­—æŒ‰é’® (æ— èƒŒæ™¯) -->
    <div style="position: fixed; bottom: 60px; width: 100%; display: flex; justify-content: center; gap: 50px; z-index: 999;">
      <div onclick="document.querySelector('input[type=file]').click()" style="color: #fff; font-size: 15px; cursor: pointer; text-shadow: 0 2px 4px #000;">
        ğŸ æŒ‚ç…§ç‰‡
      </div>
      <div onclick="createPoster()" style="color: #fceabb; font-size: 15px; cursor: pointer; font-weight: bold; text-shadow: 0 2px 4px #000;">
        âœ¨ ç”Ÿæˆè´ºå¡
      </div>
    </div>

    <!-- æµ·æŠ¥å¼¹çª— -->
    <div id="poster-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; align-items: center; justify-content: center;">
      <img id="final-image" style="width: 85%; max-width: 450px; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);" />
      <div onclick="document.getElementById('poster-modal').style.display='none'" style="margin-top: 30px; color: #fff; font-size: 30px;">Ã—</div>
    </div>

    <div id="qrcode-container" style="display: none;"></div>

    <script>
      function createPoster() {
              function createPoster() {
        const treeCanvas = document.querySelector('canvas');
        if (!treeCanvas) { alert('åŠ è½½ä¸­...'); return; }

        const cvs = document.createElement('canvas');
        const ctx = cvs.getContext('2d');
        const W = 1080; const H = 1920; 
        cvs.width = W; cvs.height = H;

        // 1. ç»˜åˆ¶èƒŒæ™¯
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, W, H);
        
        // 2. ç»˜åˆ¶æ ‘ (å¼ºåˆ¶é“ºæ»¡)
        const sW = treeCanvas.width;
        const sH = treeCanvas.height;
        const scale = Math.max(W/sW, H/sH);
        const dx = (W - sW * scale) / 2;
        const dy = (H - sH * scale) / 2;
        ctx.drawImage(treeCanvas, dx, dy, sW * scale, sH * scale);

        // 3. é®ç½©
        const gradient = ctx.createLinearGradient(0, H - 700, 0, H);
        gradient.addColorStop(0, 'rgba(0,0,0,0)');
        gradient.addColorStop(1, '#000');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, H - 700, W, 700);

        // 4. æ–‡å­—
        ctx.textAlign = 'center';
        ctx.font = 'bold 180px "Times New Roman"';
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.fillText('2026', W/2, H - 480);
        ctx.font = '50px "Songti SC", serif';
        ctx.fillStyle = '#fceabb';
        ctx.fillText("å²å²å¸¸æ¬¢æ„‰ï¼Œå¹´å¹´çš†èƒœæ„", W/2, H - 400);

        // 5. ã€å…³é”®ä¿®å¤ã€‘ç¨³å¥çš„äºŒç»´ç ç”Ÿæˆé€»è¾‘
        const container = document.getElementById('qrcode-container');
        container.innerHTML = ''; // æ¸…ç©ºæ—§çš„
        
        // ç”ŸæˆäºŒç»´ç 
        new QRCode(container, {
          text: window.location.href, width: 256, height: 256,
          colorDark : "#d4af37", colorLight : "transparent",
          correctLevel : QRCode.CorrectLevel.L // é™ä½å®¹é”™ç‡ï¼Œæé«˜ç”Ÿæˆé€Ÿåº¦
        });

        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘è½®è¯¢æ£€æµ‹ï¼šæ¯ 50ms æ£€æŸ¥ä¸€æ¬¡å›¾ç‰‡æ˜¯å¦ç”Ÿæˆï¼Œç›´åˆ°ç”Ÿæˆä¸ºæ­¢
        let attempts = 0;
        const checkInterval = setInterval(() => {
          const qrImg = container.querySelector('img');
          
          // å¦‚æœå›¾ç‰‡ç”Ÿæˆäº†ï¼Œå¹¶ä¸”æœ‰ src (è¯´æ˜åŠ è½½å¥½äº†)
          if (qrImg && qrImg.src) {
            clearInterval(checkInterval); // åœæ­¢æ£€æµ‹
            
            // ç¡®ä¿å›¾ç‰‡å®Œå…¨åŠ è½½åå†ç”»
            if (qrImg.complete) {
               drawQRCode(qrImg);
            } else {
               qrImg.onload = () => drawQRCode(qrImg);
            }
          }

          // è¶…æ—¶ä¿åº• (é˜²æ­¢æ­»å¾ªç¯)ï¼šå¦‚æœ 3ç§’è¿˜æ²¡å‡ºæ¥ï¼Œå°±ç¡¬ç”»
          attempts++;
          if (attempts > 60) {
            clearInterval(checkInterval);
            alert("ç”ŸæˆäºŒç»´ç è¶…æ—¶ï¼Œè¯·é‡è¯•");
          }
        }, 50);

        // ç»˜åˆ¶äºŒç»´ç çš„å…·ä½“å‡½æ•°
        function drawQRCode(img) {
            const qrCenterY = H - 220;
            // è£…é¥°çƒåº•åº§
            ctx.fillStyle = '#b32020'; 
            ctx.beginPath(); ctx.arc(W/2, qrCenterY, 95, 0, Math.PI * 2); ctx.fill();
            // æŒ‚ç»³
            ctx.strokeStyle = '#d4af37'; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(W/2, qrCenterY - 95); ctx.lineTo(W/2, qrCenterY - 300); ctx.stroke();
            // ç™½åº•
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(W/2, qrCenterY, 80, 0, Math.PI * 2); ctx.fill();
            // äºŒç»´ç 
            ctx.drawImage(img, (W - 130)/2, qrCenterY - 65, 130, 130);
            // å…¬ä¼—å·
            ctx.font = '30px "Microsoft YaHei"'; ctx.fillStyle = '#fff';
            ctx.fillText('å…¬ä¼—å· Â· è·å˜‰è¯—è¯ç©ºé—´', W/2, H - 60);

            // æ˜¾ç¤ºæœ€ç»ˆå›¾ç‰‡
            document.getElementById('final-image').src = cvs.toDataURL('image/jpeg', 0.9);
            document.getElementById('poster-modal').style.display = 'flex';
        }
      }
      }
    </script>
  </body>
</html>
